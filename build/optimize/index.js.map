{"version":3,"sources":["../../src/optimize/index.js"],"names":["optimize","ast","table","createMainVisitor","deadCodeEliminationVisitor","Element","exit","node","name","tagName","isRC","htmlTags","includes","tableRC","getTableComponent","propsToInline","props","map","prop","children","value","attributes","find","attr","componentNode","_","merge","Object","assign","inlinepProps","components","tableDep","dependencies","component","values","rc","createdFrom","path","defaultExport"],"mappings":";;;;;kBAQwBA,Q;;AAPxB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AANA;AAQe,SAASA,QAAT,CAAkBC,GAAlB,EAAuBC,KAAvB,EAA8B;AAC3C,2BAAUD,GAAV,EAAe,6BAAcE,kBAAkBD,KAAlB,CAAd,EAAwCE,oCAAxC,CAAf;AACA,SAAOH,GAAP;AACD;;AAED,SAASE,iBAAT,CAA2BD,KAA3B,EAAkC;AAChC,SAAO;AACLG,aAAS;AACPC,WAAKC,IAAL,EAAW;AACT,cAAMC,OAAOD,KAAKE,OAAlB;AACA,cAAMC,OAAO,CAACC,mBAASC,QAAT,CAAkBJ,IAAlB,CAAd;AACA,cAAMK,UAAUC,kBAAkBN,IAAlB,EAAwBN,KAAxB,CAAhB;AACA,YAAIQ,QAAQG,OAAZ,EAAqB;AACnB;AACA,gBAAME,gBACJF,QAAQN,IAAR,CAAaS,KAAb,IACAH,QAAQN,IAAR,CAAaS,KAAb,CAAmBC,GAAnB,CAAuBC,QAAQ;AAC7B,gBAAIA,SAAS,UAAT,IAAuBX,KAAKY,QAAhC,EAA0C;AACxC,qBAAO,EAAEX,MAAMU,IAAR,EAAcE,OAAOb,KAAKY,QAA1B,EAAP;AACD;AACD,mBAAO;AACLX,oBAAMU,IADD;AAELE,qBAAOb,KAAKc,UAAL,CAAgBC,IAAhB,CAAqBC,QAAQA,KAAKf,IAAL,KAAcU,IAA3C;AAFF,aAAP;AAID,WARD,CAFF;AAWA;AACA,gBAAMM,gBAAgBC,iBAAEC,KAAF,CAAQ,EAAR,EAAYb,QAAQN,IAApB,CAAtB;AACA;AACAoB,iBAAOC,MAAP,CAAcrB,IAAd,EAAoBiB,aAApB;AACA,iBAAOjB,KAAKE,OAAZ;AACA,iBAAOF,KAAKc,UAAZ;AACA;AACA,cAAIN,aAAJ,EAAmB;AACjBc,yBAAatB,IAAb,EAAmBQ,aAAnB;AACD;AACD;AACAf,mBAASO,IAAT,EAAeL,KAAf;AACD;AACF;AA/BM;AADJ,GAAP;AAmCD;;AAED,SAASY,iBAAT,CAA2BN,IAA3B,EAAiCN,KAAjC,EAAwC;AACtC,MAAIA,MAAM4B,UAAN,CAAiBtB,IAAjB,CAAJ,EAA4B;AAC1B,WAAON,MAAM4B,UAAN,CAAiBtB,IAAjB,CAAP;AACD;AACD,QAAMuB,WAAW7B,MAAM8B,YAAN,CAAmBxB,IAAnB,CAAjB;AACA,MAAIuB,QAAJ,EAAc;AACZ,UAAME,YAAYN,OAAOO,MAAP,CAAchC,MAAM4B,UAApB,EAAgCR,IAAhC,CAChBa,MAAMA,GAAGC,WAAH,KAAmBL,SAASM,IAA5B,IAAoCF,GAAGG,aAD7B,CAAlB;AAGA,WAAOL,SAAP;AACD;AACD,SAAO,IAAP;AACD;;AAED,SAASJ,YAAT,CAAsB5B,GAAtB,EAA2Be,KAA3B,EAAkC;AAChC,2BAAUf,GAAV,EAAe,6BAAc,qCAAsBe,KAAtB,CAAd,EAA4CZ,oCAA5C,CAAf;AACD","file":"index.js","sourcesContent":["/* eslint-disable no-param-reassign */\nimport htmlTags from 'html-tags';\nimport _ from 'lodash';\nimport traverser from '../traverser';\nimport createInliningVisitor from './create-inlining-visitor';\nimport deadCodeEliminationVisitor from './dead-code-elimination-visitor';\nimport mergeVisitors from './merge-visitors';\n\nexport default function optimize(ast, table) {\n  traverser(ast, mergeVisitors(createMainVisitor(table), deadCodeEliminationVisitor));\n  return ast;\n}\n\nfunction createMainVisitor(table) {\n  return {\n    Element: {\n      exit(node) {\n        const name = node.tagName;\n        const isRC = !htmlTags.includes(name);\n        const tableRC = getTableComponent(name, table);\n        if (isRC && tableRC) {\n          // Generate collection of props name and value.\n          const propsToInline =\n            tableRC.node.props &&\n            tableRC.node.props.map(prop => {\n              if (prop === 'children' && node.children) {\n                return { name: prop, value: node.children };\n              }\n              return {\n                name: prop,\n                value: node.attributes.find(attr => attr.name === prop)\n              };\n            });\n          // Clone Mixin.\n          const componentNode = _.merge({}, tableRC.node);\n          // Convert Element in Mixin.\n          Object.assign(node, componentNode);\n          delete node.tagName;\n          delete node.attributes;\n          // Inline props.\n          if (propsToInline) {\n            inlinepProps(node, propsToInline);\n          }\n          // Check again if new Mixin has React Components.\n          optimize(node, table);\n        }\n      }\n    }\n  };\n}\n\nfunction getTableComponent(name, table) {\n  if (table.components[name]) {\n    return table.components[name];\n  }\n  const tableDep = table.dependencies[name];\n  if (tableDep) {\n    const component = Object.values(table.components).find(\n      rc => rc.createdFrom === tableDep.path && rc.defaultExport\n    );\n    return component;\n  }\n  return null;\n}\n\nfunction inlinepProps(ast, props) {\n  traverser(ast, mergeVisitors(createInliningVisitor(props), deadCodeEliminationVisitor));\n}\n"]}