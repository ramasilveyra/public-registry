{"version":3,"sources":["../../../src/tasks/Task/read-package-manifest.js"],"names":["readFile","promisify","pkgPath","packagePath","resolve","pkg","JSON","parse","scripts","validatePackageJSON","e","readPackageManifest","name","Error","version","valid"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA,MAAMA,WAAW,mBAASC,SAAT,CAAmB,aAAGD,QAAtB,CAAjB;;;+BAEe,WAAmCE,OAAnC,EAA4C;AACzD,UAAMC,cAAc,eAAKC,OAAL,CAAaF,OAAb,EAAsB,cAAtB,CAApB;AACA,QAAI;AACF,YAAMG,MAAMC,KAAKC,KAAL,EAAW,MAAMP,SAASG,WAAT,EAAsB,OAAtB,CAAjB,EAAZ;AACAE,UAAIG,OAAJ,GAAcH,IAAIG,OAAJ,IAAe,EAA7B;AACAC,0BAAoBJ,GAApB;AACA,aAAOA,GAAP;AACD,KALD,CAKE,OAAOK,CAAP,EAAU;AACV,YAAMA,CAAN;AACD;AACF,G;;WAV6BC,mB;;;;SAAAA,mB;;;AAY9B,SAASF,mBAAT,CAA6BJ,GAA7B,EAAkC;AAChC,MAAI,CAACA,IAAIO,IAAT,EAAe;AACb,UAAM,IAAIC,KAAJ,CAAU,8BAAV,CAAN;AACD;;AAED,MAAI,CAACR,IAAIS,OAAT,EAAkB;AAChB,UAAM,IAAID,KAAJ,CAAU,iCAAV,CAAN;AACD;;AAED,MAAI,CAAC,iBAAOE,KAAP,CAAaV,IAAIS,OAAjB,CAAL,EAAgC;AAC9B,UAAM,IAAID,KAAJ,CAAU,yBAAV,CAAN;AACD;AACF","file":"read-package-manifest.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport bluebird from 'bluebird';\nimport semver from 'semver';\n\nconst readFile = bluebird.promisify(fs.readFile);\n\nexport default async function readPackageManifest(pkgPath) {\n  const packagePath = path.resolve(pkgPath, 'package.json');\n  try {\n    const pkg = JSON.parse(await readFile(packagePath, 'utf-8'));\n    pkg.scripts = pkg.scripts || {};\n    validatePackageJSON(pkg);\n    return pkg;\n  } catch (e) {\n    throw e;\n  }\n}\n\nfunction validatePackageJSON(pkg) {\n  if (!pkg.name) {\n    throw new Error(\"Package doesn't have a name.\");\n  }\n\n  if (!pkg.version) {\n    throw new Error(\"Package doesn't have a version.\");\n  }\n\n  if (!semver.valid(pkg.version)) {\n    throw new Error('Invalid semver version.');\n  }\n}\n"]}