{"version":3,"file":"read-config.js","names":["access","bluebird","promisify","fs","configFileName","defaultConfig","registry","getTagName","defaultTagNameFormat","getNearestConfigFile","path","resolve","process","cwd","e","findUp","readConfig","configPath","configClass","config","default"],"sources":["../../../src/tasks/Task/read-config.js"],"sourcesContent":["import findUp from 'find-up';\nimport fs from 'fs';\nimport bluebird from 'bluebird';\nimport path from 'path';\nimport { defaultTagNameFormat } from '../Publish/get-git-tag-name';\n\nconst access = bluebird.promisify(fs.access);\n\n/**\n * The name of the config file.\n */\nexport const configFileName = 'gitpkg.config.js';\n\n/**\n * Here goes any default values.\n */\nexport const defaultConfig = {\n  registry: null,\n  getTagName: defaultTagNameFormat\n};\n\nexport async function getNearestConfigFile() {\n  // First check if config file is in same dir\n  try {\n    if (await access(path.resolve(process.cwd(), configFileName))) {\n      return configFileName;\n    }\n  } catch (e) {\n    // Ignore\n  }\n\n  // Then check in parent directories\n  return findUp(configFileName);\n}\n\n/**\n * Returns an object with configurable settings.\n *\n * @param {string} directory Path to config file.\n */\nexport default async function readConfig(configPath) {\n  try {\n    const configClass = await import(configPath);\n    let config = {};\n\n    if (typeof configClass.default === 'function') {\n      config = configClass.default();\n    } else if (typeof configClass === 'function') {\n      config = configClass();\n    }\n\n    return { ...defaultConfig, ...config };\n  } catch (e) {\n    return defaultConfig;\n  }\n}\n"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAEA,MAAMA,MAAM,GAAGC,iBAAA,CAASC,SAAT,CAAmBC,WAAA,CAAGH,MAAtB,CAAf;AAEA;AACA;AACA;;;AACO,MAAMI,cAAc,GAAG,kBAAvB;AAEP;AACA;AACA;;;AACO,MAAMC,aAAa,GAAG;EAC3BC,QAAQ,EAAE,IADiB;EAE3BC,UAAU,EAAEC;AAFe,CAAtB;;;AAKA,eAAeC,oBAAf,GAAsC;EAC3C;EACA,IAAI;IACF,IAAI,MAAMT,MAAM,CAACU,aAAA,CAAKC,OAAL,CAAaC,OAAO,CAACC,GAAR,EAAb,EAA4BT,cAA5B,CAAD,CAAhB,EAA+D;MAC7D,OAAOA,cAAP;IACD;EACF,CAJD,CAIE,OAAOU,CAAP,EAAU,CACV;EACD,CAR0C,CAU3C;;;EACA,OAAO,IAAAC,eAAA,EAAOX,cAAP,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACe,eAAeY,UAAf,CAA0BC,UAA1B,EAAsC;EACnD,IAAI;IACF,MAAMC,WAAW,GAAG,yBAAaD,UAAb,kDAApB;IACA,IAAIE,MAAM,GAAG,EAAb;;IAEA,IAAI,OAAOD,WAAW,CAACE,OAAnB,KAA+B,UAAnC,EAA+C;MAC7CD,MAAM,GAAGD,WAAW,CAACE,OAAZ,EAAT;IACD,CAFD,MAEO,IAAI,OAAOF,WAAP,KAAuB,UAA3B,EAAuC;MAC5CC,MAAM,GAAGD,WAAW,EAApB;IACD;;IAED,OAAO,EAAE,GAAGb,aAAL;MAAoB,GAAGc;IAAvB,CAAP;EACD,CAXD,CAWE,OAAOL,CAAP,EAAU;IACV,OAAOT,aAAP;EACD;AACF"}