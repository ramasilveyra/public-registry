{"version":3,"file":"upload-package.js","names":["uploadPackage","config","pkg","registry","pkgTempDir","getTempDir","pkgTempDirPkg","path","join","gitpkgPackageName","getGitTagName","execLikeShell","err","gitErrorExists","exists","stderr","indexOf","Error"],"sources":["../../../src/tasks/Publish/upload-package.js"],"sourcesContent":["import path from 'path';\nimport execLikeShell from './exec-like-shell';\nimport getTempDir from './get-temp-dir';\nimport getGitTagName from './get-git-tag-name';\n\nexport default async function uploadPackage(config, pkg, registry) {\n  const pkgTempDir = await getTempDir(pkg);\n  const pkgTempDirPkg = path.join(pkgTempDir, 'package');\n  const gitpkgPackageName = getGitTagName(pkg, config);\n  await execLikeShell('git init', pkgTempDirPkg);\n  await execLikeShell('git add .', pkgTempDirPkg);\n  await execLikeShell('git commit --no-verify -m gitpkg', pkgTempDirPkg);\n  await execLikeShell(`git remote add origin ${registry}`, pkgTempDirPkg);\n  await execLikeShell(`git tag ${gitpkgPackageName}`, pkgTempDirPkg);\n  try {\n    await execLikeShell(`git push origin ${gitpkgPackageName}`, pkgTempDirPkg);\n  } catch (err) {\n    const gitErrorExists = 'Updates were rejected because the tag already exists in the remote.';\n    const exists = err.stderr.indexOf(gitErrorExists) > -1;\n    if (exists) {\n      throw new Error(`The git tag \"${gitpkgPackageName}\" already exists in \"${registry}\".`);\n    }\n\n    throw err;\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEe,eAAeA,aAAf,CAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,QAA1C,EAAoD;EACjE,MAAMC,UAAU,GAAG,MAAM,IAAAC,mBAAA,EAAWH,GAAX,CAAzB;;EACA,MAAMI,aAAa,GAAGC,aAAA,CAAKC,IAAL,CAAUJ,UAAV,EAAsB,SAAtB,CAAtB;;EACA,MAAMK,iBAAiB,GAAG,IAAAC,sBAAA,EAAcR,GAAd,EAAmBD,MAAnB,CAA1B;EACA,MAAM,IAAAU,sBAAA,EAAc,UAAd,EAA0BL,aAA1B,CAAN;EACA,MAAM,IAAAK,sBAAA,EAAc,WAAd,EAA2BL,aAA3B,CAAN;EACA,MAAM,IAAAK,sBAAA,EAAc,kCAAd,EAAkDL,aAAlD,CAAN;EACA,MAAM,IAAAK,sBAAA,EAAe,yBAAwBR,QAAS,EAAhD,EAAmDG,aAAnD,CAAN;EACA,MAAM,IAAAK,sBAAA,EAAe,WAAUF,iBAAkB,EAA3C,EAA8CH,aAA9C,CAAN;;EACA,IAAI;IACF,MAAM,IAAAK,sBAAA,EAAe,mBAAkBF,iBAAkB,EAAnD,EAAsDH,aAAtD,CAAN;EACD,CAFD,CAEE,OAAOM,GAAP,EAAY;IACZ,MAAMC,cAAc,GAAG,qEAAvB;IACA,MAAMC,MAAM,GAAGF,GAAG,CAACG,MAAJ,CAAWC,OAAX,CAAmBH,cAAnB,IAAqC,CAAC,CAArD;;IACA,IAAIC,MAAJ,EAAY;MACV,MAAM,IAAIG,KAAJ,CAAW,gBAAeR,iBAAkB,wBAAuBN,QAAS,IAA5E,CAAN;IACD;;IAED,MAAMS,GAAN;EACD;AACF"}