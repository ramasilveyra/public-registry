{"version":3,"sources":["../../../src/tasks/Publish/index.js"],"names":["PublishTask","Task","run","registry","configPath","pkgPath","emit","readConfigFile","readPackageManifest","pkg","gitpkgRegistryURL","config","gitpkgRegistry","gitpkgPackage","name","version"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEe,MAAMA,WAAN,SAA0BC,aAA1B,CAA+B;AAC5C,QAAMC,GAAN,CAAU;AAAEC,IAAAA,QAAF;AAAYC,IAAAA,UAAZ;AAAwBC,IAAAA;AAAxB,GAAV,EAA6C;AAC3C,SAAKC,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,yBAA3B,EAD2C,CAE3C;;AACA,UAAM,KAAKC,cAAL,CAAoBH,UAApB,CAAN;AACA,SAAKE,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,yCAA3B,EAJ2C,CAK3C;;AACA,UAAM,KAAKE,mBAAL,CAAyBH,OAAzB,CAAN;AACA,SAAKC,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,gCAA3B,EAP2C,CAQ3C;AACA;;AACA,UAAM,kCAAoB,YAApB,EAAkC,KAAKG,GAAvC,EAA4CJ,OAA5C,EAAqD,YAAY;AACrE,YAAM,KAAKG,mBAAL,CAAyBH,OAAzB,CAAN;AACD,KAFK,CAAN;AAGA,UAAM,kCAAoB,gBAApB,EAAsC,KAAKI,GAA3C,EAAgDJ,OAAhD,EAAyD,YAAY;AACzE,YAAM,KAAKG,mBAAL,CAAyBH,OAAzB,CAAN;AACD,KAFK,CAAN;AAGA,UAAM,kCAAoB,SAApB,EAA+B,KAAKI,GAApC,EAAyCJ,OAAzC,EAAkD,YAAY;AAClE,YAAM,KAAKG,mBAAL,CAAyBH,OAAzB,CAAN;AACD,KAFK,CAAN,CAhB2C,CAmB3C;;AACA,SAAKC,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,uBAA3B;AACA,UAAM,6BAAe,KAAKG,GAApB,EAAyBJ,OAAzB,CAAN;AACA,SAAKC,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,uBAA3B,EAtB2C,CAuB3C;AACA;;AACA,UAAMI,iBAAiB,GAAG,MAAM,6BAAeP,QAAf,EAAyB,KAAKM,GAA9B,EAAmCJ,OAAnC,EAA4C,KAAKM,MAAjD,CAAhC;AACA,UAAM,4BAAc,KAAKA,MAAnB,EAA2B,KAAKF,GAAhC,EAAqCC,iBAArC,CAAN,CA1B2C,CA2B3C;;AACA,SAAKJ,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,gCAA3B;AACA,UAAM,kCAAoB,SAApB,EAA+B,KAAKG,GAApC,EAAyCJ,OAAzC,CAAN;AACA,UAAM,kCAAoB,aAApB,EAAmC,KAAKI,GAAxC,EAA6CJ,OAA7C,CAAN;AAEA,WAAO;AACLO,MAAAA,cAAc,EAAEF,iBADX;AAELG,MAAAA,aAAa,EAAE,4BAAc,KAAKJ,GAAnB,EAAwB,KAAKE,MAA7B,CAFV;AAGLG,MAAAA,IAAI,EAAE,KAAKL,GAAL,CAASK,IAHV;AAILC,MAAAA,OAAO,EAAE,KAAKN,GAAL,CAASM;AAJb,KAAP;AAMD;;AAvC2C","sourcesContent":["import Task from '../Task';\nimport execLifecycleScript from './exec-lifecycle-script';\nimport preparePackage from './prepare-package';\nimport uploadPackage from './upload-package';\nimport getRegistryURL from './get-registry-url';\nimport getGitTagName from './get-git-tag-name';\n\nexport default class PublishTask extends Task {\n  async run({ registry, configPath, pkgPath }) {\n    this.emit('subtask', 1, 6, 'üéõ  Reading config file');\n    // 1 - Read config.\n    await this.readConfigFile(configPath);\n    this.emit('subtask', 2, 6, 'üëÄ  Reading and validating package.json');\n    // 1 - Read and validate package.json.\n    await this.readPackageManifest(pkgPath);\n    this.emit('subtask', 3, 6, 'üèá  Running prepublish scripts');\n    // 2 - Run prepublish scripts.\n    // NOTE: this scripts might modify the package.json so we need to reload it.\n    await execLifecycleScript('prepublish', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    await execLifecycleScript('prepublishOnly', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    await execLifecycleScript('prepare', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    // 3 - Prepare package: npm pack and untar tarball to temp dir.\n    this.emit('subtask', 4, 6, '‚öôÔ∏è  Preparing package');\n    await preparePackage(this.pkg, pkgPath);\n    this.emit('subtask', 5, 6, '‚¨ÜÔ∏è  Uploading package');\n    // 4 - Upload package: create git tag from temp dir\n    // and push to resolved gitpkg registry.\n    const gitpkgRegistryURL = await getRegistryURL(registry, this.pkg, pkgPath, this.config);\n    await uploadPackage(this.config, this.pkg, gitpkgRegistryURL);\n    // 5 - Run postpublish scripts.\n    this.emit('subtask', 6, 6, 'üèá Running postpublish scripts');\n    await execLifecycleScript('publish', this.pkg, pkgPath);\n    await execLifecycleScript('postpublish', this.pkg, pkgPath);\n\n    return {\n      gitpkgRegistry: gitpkgRegistryURL,\n      gitpkgPackage: getGitTagName(this.pkg, this.config),\n      name: this.pkg.name,\n      version: this.pkg.version\n    };\n  }\n}\n"],"file":"index.js"}