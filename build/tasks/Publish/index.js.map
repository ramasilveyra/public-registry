{"version":3,"file":"index.js","names":["PublishTask","Task","run","registry","configPath","pkgPath","emit","readConfigFile","readPackageManifest","execLifecycleScript","pkg","preparePackage","gitpkgRegistryURL","getRegistryURL","config","uploadPackage","gitpkgRegistry","gitpkgPackage","getGitTagName","name","version"],"sources":["../../../src/tasks/Publish/index.js"],"sourcesContent":["import Task from '../Task';\nimport execLifecycleScript from './exec-lifecycle-script';\nimport preparePackage from './prepare-package';\nimport uploadPackage from './upload-package';\nimport getRegistryURL from './get-registry-url';\nimport getGitTagName from './get-git-tag-name';\n\nexport default class PublishTask extends Task {\n  async run({ registry, configPath, pkgPath }) {\n    this.emit('subtask', 1, 6, 'üéõ  Reading config file');\n    // 1 - Read config.\n    await this.readConfigFile(configPath);\n    this.emit('subtask', 2, 6, 'üëÄ  Reading and validating package.json');\n    // 1 - Read and validate package.json.\n    await this.readPackageManifest(pkgPath);\n    this.emit('subtask', 3, 6, 'üèá  Running prepublish scripts');\n    // 2 - Run prepublish scripts.\n    // NOTE: this scripts might modify the package.json so we need to reload it.\n    await execLifecycleScript('prepublish', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    await execLifecycleScript('prepublishOnly', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    await execLifecycleScript('prepare', this.pkg, pkgPath, async () => {\n      await this.readPackageManifest(pkgPath);\n    });\n    // 3 - Prepare package: npm pack and untar tarball to temp dir.\n    this.emit('subtask', 4, 6, '‚öôÔ∏è  Preparing package');\n    await preparePackage(this.pkg, pkgPath);\n    this.emit('subtask', 5, 6, '‚¨ÜÔ∏è  Uploading package');\n    // 4 - Upload package: create git tag from temp dir\n    // and push to resolved gitpkg registry.\n    const gitpkgRegistryURL = await getRegistryURL(registry, this.pkg, pkgPath, this.config);\n    await uploadPackage(this.config, this.pkg, gitpkgRegistryURL);\n    // 5 - Run postpublish scripts.\n    this.emit('subtask', 6, 6, 'üèá Running postpublish scripts');\n    await execLifecycleScript('postpublish', this.pkg, pkgPath);\n\n    return {\n      gitpkgRegistry: gitpkgRegistryURL,\n      gitpkgPackage: getGitTagName(this.pkg, this.config),\n      name: this.pkg.name,\n      version: this.pkg.version\n    };\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEe,MAAMA,WAAN,SAA0BC,aAA1B,CAA+B;EACnC,MAAHC,GAAG,CAAC;IAAEC,QAAF;IAAYC,UAAZ;IAAwBC;EAAxB,CAAD,EAAoC;IAC3C,KAAKC,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,yBAA3B,EAD2C,CAE3C;;IACA,MAAM,KAAKC,cAAL,CAAoBH,UAApB,CAAN;IACA,KAAKE,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,yCAA3B,EAJ2C,CAK3C;;IACA,MAAM,KAAKE,mBAAL,CAAyBH,OAAzB,CAAN;IACA,KAAKC,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,gCAA3B,EAP2C,CAQ3C;IACA;;IACA,MAAM,IAAAG,4BAAA,EAAoB,YAApB,EAAkC,KAAKC,GAAvC,EAA4CL,OAA5C,EAAqD,YAAY;MACrE,MAAM,KAAKG,mBAAL,CAAyBH,OAAzB,CAAN;IACD,CAFK,CAAN;IAGA,MAAM,IAAAI,4BAAA,EAAoB,gBAApB,EAAsC,KAAKC,GAA3C,EAAgDL,OAAhD,EAAyD,YAAY;MACzE,MAAM,KAAKG,mBAAL,CAAyBH,OAAzB,CAAN;IACD,CAFK,CAAN;IAGA,MAAM,IAAAI,4BAAA,EAAoB,SAApB,EAA+B,KAAKC,GAApC,EAAyCL,OAAzC,EAAkD,YAAY;MAClE,MAAM,KAAKG,mBAAL,CAAyBH,OAAzB,CAAN;IACD,CAFK,CAAN,CAhB2C,CAmB3C;;IACA,KAAKC,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,uBAA3B;IACA,MAAM,IAAAK,uBAAA,EAAe,KAAKD,GAApB,EAAyBL,OAAzB,CAAN;IACA,KAAKC,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,uBAA3B,EAtB2C,CAuB3C;IACA;;IACA,MAAMM,iBAAiB,GAAG,MAAM,IAAAC,uBAAA,EAAeV,QAAf,EAAyB,KAAKO,GAA9B,EAAmCL,OAAnC,EAA4C,KAAKS,MAAjD,CAAhC;IACA,MAAM,IAAAC,sBAAA,EAAc,KAAKD,MAAnB,EAA2B,KAAKJ,GAAhC,EAAqCE,iBAArC,CAAN,CA1B2C,CA2B3C;;IACA,KAAKN,IAAL,CAAU,SAAV,EAAqB,CAArB,EAAwB,CAAxB,EAA2B,gCAA3B;IACA,MAAM,IAAAG,4BAAA,EAAoB,aAApB,EAAmC,KAAKC,GAAxC,EAA6CL,OAA7C,CAAN;IAEA,OAAO;MACLW,cAAc,EAAEJ,iBADX;MAELK,aAAa,EAAE,IAAAC,sBAAA,EAAc,KAAKR,GAAnB,EAAwB,KAAKI,MAA7B,CAFV;MAGLK,IAAI,EAAE,KAAKT,GAAL,CAASS,IAHV;MAILC,OAAO,EAAE,KAAKV,GAAL,CAASU;IAJb,CAAP;EAMD;;AAtC2C"}